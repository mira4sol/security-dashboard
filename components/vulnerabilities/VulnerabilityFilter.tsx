import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
import {
  vulnerabilityExploitTypes,
  vulnerabilityProtocolTypes,
} from '@/lib/constants/schema'
import { Download, Filter, Search } from 'lucide-react'
import { useState } from 'react'

interface VulnerabilityFilterProps {
  onSearch: (term: string) => void
  onFilterExploitType: (type: string | null) => void
  onFilterProtocolType: (type: string | null) => void
  onExport: () => void
}

const VulnerabilityFilter = ({
  onSearch,
  onFilterExploitType,
  onFilterProtocolType,
  onExport,
}: VulnerabilityFilterProps) => {
  const [searchTerm, setSearchTerm] = useState('')
  const [showFilters, setShowFilters] = useState(false)

  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setSearchTerm(e.target.value)
    onSearch(e.target.value)
  }

  return (
    <div className='flex flex-col gap-4'>
      <div className='flex flex-wrap items-center gap-4'>
        <div className='relative flex-grow max-w-md'>
          <Input
            type='text'
            placeholder='Search exploits...'
            value={searchTerm}
            onChange={handleSearchChange}
            className='terminal-input py-2 px-3 rounded text-sm w-full pl-10'
          />
          <Search className='absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500' />
        </div>

        <div className='flex gap-2'>
          <Button
            variant='terminal'
            size='sm'
            onClick={() => setShowFilters(!showFilters)}
            className='flex items-center gap-1'
          >
            <Filter className='h-4 w-4' />
            <span>Filter</span>
          </Button>

          <Button
            variant='terminal'
            size='sm'
            onClick={onExport}
            className='flex items-center gap-1'
          >
            <Download className='h-4 w-4' />
            <span>Export</span>
          </Button>
        </div>
      </div>

      {showFilters && (
        <div className='grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-muted rounded-md'>
          <div>
            <label className='block text-gray-400 text-sm mb-2'>
              Exploit Type
            </label>
            <Select
              onValueChange={(value) =>
                onFilterExploitType(value === 'all' ? null : value)
              }
            >
              <SelectTrigger className='terminal-input'>
                <SelectValue placeholder='All exploit types' />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value='all'>All exploit types</SelectItem>
                {vulnerabilityExploitTypes.map((type) => (
                  <SelectItem key={type} value={type}>
                    {type}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          <div>
            <label className='block text-gray-400 text-sm mb-2'>
              Protocol Type
            </label>
            <Select
              onValueChange={(value) =>
                onFilterProtocolType(value === 'all' ? null : value)
              }
            >
              <SelectTrigger className='terminal-input'>
                <SelectValue placeholder='All protocol types' />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value='all'>All protocol types</SelectItem>
                {vulnerabilityProtocolTypes.map((type) => (
                  <SelectItem key={type} value={type}>
                    {type}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
        </div>
      )}
    </div>
  )
}

export default VulnerabilityFilter
